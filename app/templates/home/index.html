{% extends 'base.html' %} 

{% load static %}

{% block title %}Cardápio{% endblock %} 

{% block content %}
<h2 style='width: 100%; text-align: center;'>Nossos pratos</h2>
<section id="index-view">
  {% for p in pratos %}
    <div class="card">
      <div class="card-img" style="background-image: url('{{ p.image }}');"></div>
      <div class="card-data">
        <h5 class="card-data-title">{{ p.name }}</h5>
        <p class="card-data-desc">{{ p.desc }}</p>
        <p class="card-data-ingredients">
          <strong>Ingredientes: </strong><br>{{ p.ingredients }}
        </p>
      </div>
      <div class="card-div-btn">
        {% if p.disponibilidade %}
        <button class="card-btn pulse modal-trigger" style="z-index: 100;" data-target="modal{{p.id}}"><b>R$ {{ p.value }}</b><!--<span class="material-icons" style="font-size: 48px;">shopping_basket</span>--></button>
        {% else %}
        <button class="card-btn pulse modal-trigger" style="z-index: 100;" data-target="modal-indisponivel"><b>R$ {{ p.value }}</b><!--<span class="material-icons" style="font-size: 48px;">shopping_basket</span>--></button>
        {% endif %}
      </div>
    </div>
    <div id="modal{{p.id}}" class="modal">
      {% for g in gerencial %}
      {% if time.tm_hour <= g.abertura or time.tm_hour >= g.fechamento %}
      <div class="modal-content">
        <div style="height: 400px; display: flex; justify-content: center; align-items: center; flex-direction: column;">
          <h5>Estamos fechados</h5>
          <h6>Abriremos novamente as {{ g.abertura }} horas!</h6>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn modal-close">Fechar</button>
      </div>
      {% else %}
      <div class="modal-content">
        <h4>{{ p.name }}</h4>
        <div class="card-img" style="background-image: url('{{ p.image }}'); width: 100%; height: 100px; border-radius: 5px;"></div>
        <div class="card-data" style="width: 100%; display: flex; align-items: center; flex-direction: column;">
          <h6 style="margin-top: 24px;"><b>Informações adicionais</b></h6>
          <div class='div-qtd'>
            <div class="input-field" style="width: 150px; margin-right: 16px;">
              <input type="number" name="qtd" id="qtd" v-model="qtd">
              <label for="qtd">Quantidade</label>
            </div>
            <div class="input-field" style="width: 150px;">            
              <p>
                <label style="display: flex; align-items: center;">
                  <input type="checkbox" class="filled-in" v-model="maionese">
                  <span>Maionese?</span>
                </label>
              </p>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button v-on:click="pedidos({{ p.id }})" class="btn modal-close">Adicionar ao pedido</button>
      </div>
      {% endif %}
      {% endfor %}
    </div>
    
    {% endfor %}
    
  <!-- Modal Structure -->
  <div id="modal-carrinho" class="modal">
    {% for g in gerencial %}
    {% if time.tm_hour <= g.abertura or time.tm_hour >= g.fechamento %}
    <div class="modal-content">
      <div style="height: 400px; display: flex; justify-content: center; align-items: center; flex-direction: column;">
        <h5>Fechamos às {{ g.fechamento }} horas</h5>
        <h6>Abriremos novamente as {{ g.abertura }} horas!</h6>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn modal-close">Fechar</button>
    </div>
    {% else %}
    <form action='/pedidos/addpedido/' method="POST">
      {% csrf_token %}
      <div class="modal-content">
        
        <h4>Seu Pedido</h4>
        <div v-for="ped in pedido">
          <div style="align-items: center; display: flex; flex-wrap: wrap;">
            <div class="img-pedido" :style="{'background-image': 'url('+ped.image+')'}"></div>
            <div style="display: flex; flex-direction: column;">
              <h6><b>Nome:</b> [[ ped.title ]]</h6>
              <div style="display: flex; justify-content: space-between">
                <h6><b>Qtd:</b> [[ ped.qtd ]]</h6>
                <h6><b>Valor: </b>[[ ped.total ]]</h6>
              </div>
              <h6 v-if="ped.maionese == true"><b>Maionese?</b> Sim</h6>
              <h6 v-else><b>Maionese?</b> Não</h6>
            </div>
          </div>
          <hr>
        </div>
        
        <p v-show="total" style="text-align: end;"><b>Total: </b>R$ [[ total ]]</p>
        <div class="card-data">
          <h6 class="card-data-title"><strong>{{ p.name }}</strong></h6>
        </div>
        <div style="display: flex; align-items: center;">
          <div class="input-field" style="width: 30%; margin-right: 10%;  ">
            <input type="text" name="cpf" id="cpf" maxlength="14"v-on:keydown="cpfMaskDown($event)" v-on:keyup="cpfMaskUp($event)">
            <label for="cpf" id="cpfLabel">CPF</label>
          </div>
          <div class="input-field" style="width: 60%;">
            <input type="text" name="idname" id="idname" maxlength="30" v-model="nome">
            <label for="idname" id="nameLabel">Nome</label>
          </div>
        </div>
        <div class="forma-retirada">
          <label style="display: flex; align-items: center;">
            <input type="checkbox" class="filled-in" @click="retiradaForma" v-model="entrega">
            <span>Entrega?</span>
          </label>
          <label style="display: flex; align-items: center;">
            <input type="checkbox" class="filled-in" @click="retiradaForma" v-model="retirada">
            <span>Retirar no local?</span>
          </label>
          <label style="display: flex; align-items: center;">
            <input type="checkbox" class="filled-in" @click="retiradaForma" v-model="local">
            <span>Comer no local?</span>
          </label>
        </div>
        <div v-show="entrega">
          <div class="input-field">
            <input type="text" name="rua" id="rua" maxlength="50" v-model="end">
            <label for="rua">Rua/Bairro/Nº</label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <a class="btn modal-close" style="z-index: 100; background-color: #222; margin-right: 16px;" data-target="modal1">Voltar</a>
        <a v-if="link != null" :href="link+linkFone+linkText" target="_blank" @click="sendPedido" class="modal-close btn" style="z-index: 100; background-color: rgb(199, 143, 0);" data-target="modal1">Finalizar Pedido</a>
        <a v-else target="_blank" @click="sendPedido" class="btn" style="z-index: 100; background-color: rgb(199, 143, 0);" data-target="modal1">Finalizar Pedido</a>
      </div>
    </form>
    {% endif %}
    {% endfor %}
  </div>

  <!-- MODAL INDISPONIVEL -->
  <div id="modal-indisponivel" class="modal">
    {% for g in gerencial %}
    {% if time.tm_hour <= g.abertura or time.tm_hour >= g.fechamento %}
    <div class="modal-content">
      <div style="height: 400px; display: flex; justify-content: center; align-items: center; flex-direction: column;">
        <h5>Fechamos às {{ g.fechamento }} horas</h5>
        <h6>Abriremos novamente as {{ g.abertura }} horas!</h6>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn modal-close">Fechar</button>
    </div>
    {% else %}
    <div class="modal-content">
      <div class="card-data" style="width: 100%; height: 400px; display: flex; justify-content: center; align-items: center; flex-direction: column;">
        <h5>Dog indisponível</h5>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn modal-close">Fechar</button>
    </div>
  </div>
  {% endif %}
  {% endfor %}
</section>

<div class="fixed-action-btn">
  <a class="btn-floating btn-large red pulse modal-trigger" data-target="modal-carrinho">
    <i class="large material-icons">shopping_basket</i>
  </a>
</div>
{% endblock %}
{% block script %}
  <script src="{% static 'js/components/index.js' %}"></script>
{% endblock %}
